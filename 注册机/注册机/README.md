# Web邮件客户端

这是一个基于Flask的Web邮件客户端，可以连接到Outlook邮箱并在浏览器中查看邮件。

## 功能特性

- 📧 **邮件列表展示**: 以现代化的卡片形式展示邮件列表
- 🔍 **搜索功能**: 支持按发件人、主题、内容搜索邮件
- 📖 **邮件详情**: 点击邮件查看完整内容，支持纯文本和HTML格式
- 📱 **响应式设计**: 适配桌面和移动设备
- 🔄 **实时刷新**: 手动刷新获取最新邮件
- 🎨 **美观界面**: 采用现代化设计风格

## 技术栈

- **后端**: Flask (Python)
- **前端**: Bootstrap 5 + JavaScript
- **邮件协议**: IMAP with OAuth2
- **样式**: CSS3 + Font Awesome图标

## 安装和运行

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置邮箱信息

在 `app.py` 文件中更新你的邮箱配置：

```python
EMAIL_CONFIG = {
    'client_id': '你的客户端ID',
    'email': '你的邮箱地址',
    'refresh_token': '你的刷新令牌'
}
```

### 3. 运行应用

```bash
# 推荐方式1：使用智能启动脚本（从任意目录）
python run.py

# 推荐方式2：使用启动脚本（需在项目目录内）
python start_server.py

# 方式3：直接运行
python app.py
```

### 4. 访问应用

打开浏览器访问：http://localhost:5001

> **注意**: 如果5001端口被占用，脚本会自动寻找可用端口 (5002-5010)

## 项目结构

```
注册机/注册机/
├── app.py              # Flask主应用
├── email_service.py    # 邮件服务类
├── start_server.py     # 启动脚本
├── run.py             # 智能启动脚本
├── test_email.py      # 测试脚本
├── requirements.txt    # Python依赖
├── README.md          # 项目说明
├── templates/         # HTML模板
│   ├── index.html     # 邮件列表页面
│   └── email_detail.html  # 邮件详情页面
└── get_email.py       # 原始邮件获取脚本（参考）
```

## API接口

### 获取邮件列表
- **URL**: `/api/emails`
- **方法**: GET
- **参数**: `limit` (可选，默认50)
- **返回**: JSON格式的邮件列表

### 获取邮件详情
- **URL**: `/api/emails/<email_id>`
- **方法**: GET
- **返回**: JSON格式的邮件详细信息

## 界面截图

### 邮件列表页面
- 显示发件人、主题、预览内容和时间
- 支持搜索和筛选
- 响应式设计，适配各种设备

### 邮件详情页面
- 完整的邮件内容展示
- 支持纯文本和HTML格式切换
- 邮件元信息展示（发件人、日期等）

## 注意事项

1. **OAuth2配置**: 需要有效的Microsoft应用客户端ID和刷新令牌
2. **网络连接**: 需要能够访问outlook.office365.com
3. **权限设置**: 确保应用有读取邮件的权限
4. **端口设置**: 默认使用5001端口，避免与macOS AirPlay冲突

## 待实现功能

- [ ] 邮件回复功能
- [ ] 邮件转发功能
- [ ] 邮件删除功能
- [ ] 邮件标记为已读/未读
- [ ] 邮件分页加载
- [ ] 邮件附件下载
- [ ] 多邮箱账户支持

## 故障排除

### 常见问题

1. **访问令牌过期**: 检查refresh_token是否有效
2. **IMAP连接失败**: 确认网络连接和账户权限
3. **邮件内容乱码**: 检查邮件编码处理
4. **端口被占用**: 
   - macOS用户：关闭系统偏好设置 -> 共享 -> AirPlay接收器
   - 或使用智能启动脚本自动寻找可用端口
5. **目录错误**: 使用 `python run.py` 从任意目录启动

### 调试模式

应用默认以调试模式运行，可以在终端看到详细的错误信息。

### 快速测试

运行测试脚本验证配置：
```bash
python test_email.py
```

## 许可证

本项目仅供学习和研究使用。 